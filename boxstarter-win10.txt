# BOXSTARTER PREPARATION
Set-WindowsExplorerOptions -EnableShowHiddenFilesFoldersDrives -EnableShowProtectedOSFiles -EnableShowFileExtensions

cup chocolatey    --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"

# Workaround for issue #241
# Source https://github.com/chocolatey/boxstarter/issues/241#issuecomment-336028348
# Real fix: https://github.com/chocolatey/boxstarter/pull/479
New-Item -Path "$env:userprofile\AppData\Local\ChocoCache" -ItemType directory -Force


# Using 'cup' (choco upgrade) instead of 'cinst' (cup) to make the script idempotent
# https://docs.chocolatey.org/en-us/choco/commands/upgrade


### CONFIGURATION ###
Enable-RemoteDesktop


### SWINSTALL ###

# COLLABORATION
cup anydesk         --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup discord         --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup slack           --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup teamviewer      --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"

cup webex-meetings  --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" --ignore-checksums
                      # As the URL of the installer is always the same https://akamaicdn.webex.com...,
                      # there is no other solution than waiting the review of the new version. 
                      # In other words, we cant publish immediately a new Chocolatey package when webex 
                      # release a new version using a same URL but with a different checksum.
                      
cup zoom            --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# DEV TOOLS
cup git                 --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" --params "/GitAndUnixToolsOnPath"
cup jetbrainstoolbox    --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup nodejs-lts          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # reveal.js requires a stable version


# FILEHANDLING
cup totalcommander  --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# FONTS
cup jetbrainsmono   --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup sourcecodepro   --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# GRAPHICS
cup darktable       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # Image tool
cup digikam         --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # Image tool looks better (v7.3.0)
cup ffmpeg          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup graphviz        --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup greenshot       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup handbrake       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup irfanview       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup irfanview-shellextension    --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup irfanviewplugins            --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"    

# OBS: Other video tools must not be running (EG Teams, VLC etc) as they block the install (Virtual Camera stuff)
Stop-Process -Name "Teams"
Stop-Process -Name "Vlc" 
cup obs-studio      --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" --forced --not-silent

cup vlc             --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" --params "'/Language:en'"
cup zeplin          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# LINUX
# etcher: Create bootable linux USB devices (NB.: The actual name is 'balenaEtcher')
cup etcher          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"

Stop-Process -Name "WindowsTerminal" # Cannot be updated while running
cup microsoft-windows-terminal  --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"

cup rpi-imager      --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup rufus           --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"

# vcxsrv: For WSL2 GUI, https://techcommunity.microsoft.com/t5/windows-dev-appconsult/running-wsl-gui-apps-on-windows-10/ba-p/1493242
cup vcxsrv          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup wsl2            --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" --params /Retry:true

# wsl-ubuntu-2004: Requires manual launch to complete the setup (create a user)
cup wsl-ubuntu-2004     --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# NETWORK
cup iperf3          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup iperf2          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup nmap            --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"    
cup postman         --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"    
cup putty.install   --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup telnet          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup wireshark       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup winpcap         --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup youtube-dl      --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# OFFICE
cup adobereader         --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup office365business   --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# SECURITY
cup bitwarden       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# SYSTEM TOOLS
cup bluetoothview   --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # Nirsoft tool

# carnac: Display keyboard strokes (for video demoing), https://github.com/Code52/carnac 
cup carnac          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" 

cup dotnet3.5       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup gpu-z           --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup javaruntime     --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # For freeplane
cup hwinfo          --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup smartmontools   --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"    
cup samsung-magician    --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # Triggers UI execution of the installer!
cup sysinternals    --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# TEXT
cup freeplane       --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"

# notepad++: Upgrade NP++ is unsuccessful if app is running, killing it is safe as it recalls even unsaved documents :-)
Stop-Process -Name "notepad++"
cup notepadplusplus --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"


# WEB
cup googlechrome    --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup hugo            --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"

# WINDOWS UTILS
cup powertoys           --cacheLocation "$env:userprofile\AppData\Local\ChocoCache"
cup sharpkeys.portable  --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # Key remapping tool
cup usbdeview           --cacheLocation "$env:userprofile\AppData\Local\ChocoCache" # Nirsoft USB speed test tool






# DEPRECATED STUFF
# cup jabra-direct --ignore-checksum # same rootcause as 'webex-meetings'
# cup aquasnap
#cup keyboard-layout-creator
    # DEBUG cup keyboard-layout-creator --install-arguments="'/l*v c:\keyboard-layout-creator_msi_install.log'"
    # Show the requirement of dot net 2.0, a "Windows Feture"
# cup mobaxterm                         # Not the PRO version, that's only available outside Choco :(
